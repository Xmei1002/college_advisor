<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>志愿方案报告</title>
    <style>
        /* 基本样式 */
        body {
            font-family: "Noto Sans CJK SC", "WenQuanYi Micro Hei", "Microsoft YaHei", SimSun, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
        }

        /* 页面设置 */
        @page {
            size: A4;
            margin: 1cm;
            margin-top: 2cm;
            margin-bottom: 2cm;

            @top-center {
                content: "高考志愿填报方案";
                font-size: 9pt;
            }

            @bottom-center {
                content: "第 " counter(page) " 页 / 共 " counter(pages) " 页";
                font-size: 9pt;
            }
        }

        /* 特殊页面设置 */
        @page :first {
            size: A4;
            margin: 0cm;

            @top-center {
                content: normal;
            }

            @bottom-center {
                content: normal;
            }
        }

        /* 封面样式 */
        .cover {
            position: relative;
            /* 添加这行，让子元素可以相对它绝对定位 */
            height: 29.7cm;
            width: 21cm;
            /* 明确设置宽度，A4纸尺寸 */
            background-image: url('data:image/png;base64,{{ cover_img_base64 }}');
            background-size: cover;
            background-position: center;
            margin: 0 auto;
            /* 居中显示 */
        }

        .student-info-corner {
            position: absolute;
            bottom: 100px;
            left: 100px;
            /* 距离左侧40px */
            width: 300px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            /* 半透明背景，确保文字可读 */
            border-radius: 8px;
            /* 圆角效果 */
        }

        .student-info-text p {
            margin: 5px 0;
            font-size: 20px;
            /* 略微调小字体 */
            color: #000;
            /* 确保文字颜色清晰可见 */
        }

        .cover h1 {
            font-size: 32pt;
            margin-bottom: 2cm;
            color: #2c3e50;
        }

        /* 目录样式 */
        .toc {
            page-break-after: always;
            padding: 20px;
        }

        .toc h2 {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 5px;
        }

        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }

        .toc li {
            margin: 10px 0;
        }

        .toc a {
            text-decoration: none;
            color: #3498db;
        }

        /* 章节样式 */
        .section {
            margin-bottom: 30px;
            page-break-after: always;
        }

        .section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 5px;
        }

        /* 志愿表格样式 */
        .volunteer-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 10pt;
        }

        .volunteer-table th,
        .volunteer-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }

        .volunteer-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            text-align: center;
        }

        .category-header th {
            background-color: #3498db;
            color: white;
            font-size: 14pt;
        }

        /* 分析部分样式 */
        .analysis-section {
            margin-bottom: 20px;
            break-inside: avoid;
        }

        .analysis-section h3 {
            color: #3498db;
            border-bottom: 1px solid #3498db;
            padding-bottom: 3px;
        }

        .analysis-section h4 {
            color: #2c3e50;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        .analysis-section p {
            margin: 5px 0;
            line-height: 1.5;
        }

        /* 专业列表样式 */
        .specialty-list {
            padding-left: 0;
            margin: 0;
            list-style-type: none;
            font-size: 12px;
        }

        .specialty-item {
            margin-bottom: 5px;
            padding: 3px 5px;
            background-color: #f8f9fa;
            border-radius: 3px;
        }

        .specialty-item.highlight {
            background-color: #e3f2fd;
            font-weight: bold;
        }

        /* 历史数据样式 */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
            font-size: 9pt;
        }

        .history-table th,
        .history-table td {
            border: 1px solid #ddd;
            padding: 3px;
            text-align: center;
        }

        .history-table th {
            background-color: #f5f5f5;
        }

        /* 其他信息样式 */
        .college-meta {
            margin-top: 5px;
            font-size: 9pt;
            color: #666;
        }

        .college-meta span {
            display: inline-block;
            margin-right: 10px;
        }

        .badge {
            display: inline-block;
            padding: 2px 5px;
            background-color: #e3f2fd;
            border-radius: 3px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 9pt;
        }

        /* 其他样式 */
        .footer {
            text-align: center;
            font-size: 9pt;
            margin-top: 30px;
            color: #7f8c8d;
        }

        /* 分页控制 */
        .page-break {
            page-break-after: always;
        }

        .no-break {
            page-break-inside: avoid;
        }
    </style>
</head>

<body>
    <!-- 封面部分 -->
    <div class="cover">
        <div class="student-info-corner">
            <div class="student-info-text">
                <p><strong>姓名：</strong>{{ student.student.name }}</p>
                <p><strong>性别：</strong>{{ student.student.gender }}</p>
                <p><strong>学科组合：</strong>{{ student.academic_record.selected_subjects }}</p>
                <p><strong>分数：</strong>
                    {% if student.academic_record.gaokao_total_score is not none and
                    student.academic_record.gaokao_total_score|int >= 0 %}
                    {{ student.academic_record.gaokao_total_score }}分
                    {% else %}
                    {{ student.academic_record.mock_exam_score }}分（模考成绩）
                    {% endif %}
                </p>
                <p><strong>生成日期：</strong>{{ render_date }}</p>
            </div>
        </div>

    </div>

    <!-- 目录部分 -->
    <div class="toc">
        <h2>目录</h2>
        <ul>
            <li><a href="#summary">1. 整体概述</a></li>
            <li><a href="#chasing">2. 冲刺志愿解析</a></li>
            <li><a href="#stable">3. 稳妥志愿解析</a></li>
            <li><a href="#safe">4. 保底志愿解析</a></li>
            <li><a href="#plan-table">5. 志愿方案表</a></li>
        </ul>
    </div>

    <!-- 整体概述部分 -->
    <div id="summary" class="section">
        <h2>1. 整体概述</h2>

        {% for analysis in volunteer_plan.category_analyses %}
        {% if analysis.category_id == 0 %}
        {% if analysis.content_object %}
        {% for key, value in analysis.content_object.items() %}
        <div class="analysis-section">
            <h3>{{ key }}</h3>
            {% if value is mapping %}
            {% for subkey, subvalue in value.items() %}
            <h4>{{ subkey }}</h4>
            <p>{{ subvalue }}</p>
            {% endfor %}
            {% else %}
            <p>{{ value }}</p>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}
        {% endfor %}
    </div>

    <!-- 冲刺志愿解析部分 -->
    <div id="chasing" class="section">
        <h2>2. 冲刺志愿解析</h2>

        {% for analysis in volunteer_plan.category_analyses %}
        {% if analysis.category_id == 1 %}
        {% if analysis.content_object %}
        {% for key, value in analysis.content_object.items() %}
        {% if key != "志愿层次" %}
        <div class="analysis-section">
            <h3>{{ key }}</h3>
            {% if value is mapping %}
            {% for subkey, subvalue in value.items() %}
            <h4>{{ subkey }}</h4>
            <p>{{ subvalue }}</p>
            {% endfor %}
            {% else %}
            <p>{{ value }}</p>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endif %}
        {% endfor %}
    </div>

    <!-- 稳妥志愿解析部分 -->
    <div id="stable" class="section">
        <h2>3. 稳妥志愿解析</h2>

        {% for analysis in volunteer_plan.category_analyses %}
        {% if analysis.category_id == 2 %}
        {% if analysis.content_object %}
        {% for key, value in analysis.content_object.items() %}
        {% if key != "志愿层次" %}
        <div class="analysis-section">
            <h3>{{ key }}</h3>
            {% if value is mapping %}
            {% for subkey, subvalue in value.items() %}
            <h4>{{ subkey }}</h4>
            <p>{{ subvalue }}</p>
            {% endfor %}
            {% else %}
            <p>{{ value }}</p>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endif %}
        {% endfor %}
    </div>

    <!-- 保底志愿解析部分 -->
    <div id="safe" class="section">
        <h2>4. 保底志愿解析</h2>

        {% for analysis in volunteer_plan.category_analyses %}
        {% if analysis.category_id == 3 %}
        {% if analysis.content_object %}
        {% for key, value in analysis.content_object.items() %}
        {% if key != "志愿层次" %}
        <div class="analysis-section">
            <h3>{{ key }}</h3>
            {% if value is mapping %}
            {% for subkey, subvalue in value.items() %}
            <h4>{{ subkey }}</h4>
            <p>{{ subvalue }}</p>
            {% endfor %}
            {% else %}
            <p>{{ value }}</p>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endif %}
        {% endfor %}
    </div>

    <!-- 志愿方案表部分 -->
    <div id="plan-table" class="section">
        <h2>5. 志愿方案表</h2>
        <table class="volunteer-table"
            style="text-align: center; vertical-align: middle; width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 10pt;">
            <thead>
                <tr>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 8%;">
                        志愿序号</th>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 25%;">
                        学校信息</th>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 8%;">
                        计划</th>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 28%;">
                        推荐专业</th>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 23%;">
                        历年数据(2022-2024)</th>
                    <th
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; background-color: #f2f2f2; font-weight: bold; text-align: center; width: 8%;">
                        是否同意调剂</th>
                </tr>
            </thead>
            <tbody>
                {% for college in volunteer_plan.colleges %}
                <tr class="no-break">
                    <td style="text-align: center; vertical-align: middle; border: 1px solid #ddd; padding: 6px;">
                        <div><strong>第{{ college.volunteer_index }}志愿</strong></div>
                        <div style="margin-top: 3px;">
                            {% if college.category_id == 1 %}
                            <span
                                style="background-color: #FF9966; padding: 1px 4px; border-radius: 3px; font-size: 8pt; display: inline-block;">冲刺</span>
                            {% elif college.category_id == 2 %}
                            <span
                                style="background-color: #99CCFF; padding: 1px 4px; border-radius: 3px; font-size: 8pt; display: inline-block;">稳妥</span>
                            {% elif college.category_id == 3 %}
                            <span
                                style="background-color: #99CC99; padding: 1px 4px; border-radius: 3px; font-size: 8pt; display: inline-block;">保底</span>
                            {% endif %}
                        </div>
                    </td>
                    <td style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; text-align: left;">
                        <div>
                            <strong>{{ college.college_name }}（{{ college.group_name }}）</strong>
                        </div>
                        <div style="margin-top: 2px; font-size: 8pt;">
                            <strong>代号:</strong>{{college.uncode }}
                        </div>
                        <div style="margin-top: 2px; font-size: 8pt;">
                            <span ><strong>性质:</strong>{{college.nature }}   类型:</strong>{{ college.school_type_text}}</span>
                        </div>
                        <div style="margin-top: 2px; font-size: 8pt;">
                            <strong>学费:</strong>{{college.min_tuition }}-{{ college.max_tuition }}元
                        </div>
                        <div style="margin-top: 2px; font-size: 8pt;">
                            <strong>属地:</strong>{{ college.area_name }}
                        </div>
                        {% if college.tese_text %}
                        <div style="margin-top: 2px; font-size: 8pt;">
                            <strong>特色:</strong>
                            {% for tese in college.tese_text %}
                            <span
                                style="background-color: #f2f2f2; padding: 0px 3px; border-radius: 2px; font-size: 7pt; margin-right: 2px; display: inline-block;">{{
                                tese }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% if college.subject_requirements %}
                        <div style="margin-top: 2px; font-size: 7pt;">
                            <strong>必选:</strong>
                            {% if college.subject_requirements.wu == 1 %}<span style="margin-right: 3px;">物理</span>{%
                            endif %}
                            {% if college.subject_requirements.hua == 1 %}<span style="margin-right: 3px;">化学</span>{%
                            endif %}
                            {% if college.subject_requirements.sheng == 1 %}<span style="margin-right: 3px;">生物</span>{%
                            endif %}
                            {% if college.subject_requirements.shi == 1 %}<span style="margin-right: 3px;">历史</span>{%
                            endif %}
                            {% if college.subject_requirements.di == 1 %}<span style="margin-right: 3px;">地理</span>{%
                            endif %}
                            {% if college.subject_requirements.zheng == 1 %}<span style="margin-right: 3px;">政治</span>{%
                            endif %}
                        </div>
                        {% endif %}
                    </td>
                    <td
                        style="text-align: center; vertical-align: middle; border: 1px solid #ddd; padding: 6px; font-size: 9pt;">
                        <div><strong>招生:</strong><br>{{ college.plan_number }}人</div>
                        <div style="margin-top: 2px;"><strong>扩招:</strong><br>{{ college.plan_increase }}人</div>
                    </td>
                    <td
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; text-align: left; font-size: 8pt;">
                        {% for specialty in college.specialties %}
                        <div style="margin-bottom: 2px; ">
                            {{specialty.specialty_index}}. {{ specialty.specialty_name }}（计划:{{ specialty.plan_number
                            }}人/学费:{{ specialty.tuition }}元）
                        </div>
                        {% endfor %}
                    </td>
                    <td
                        style="vertical-align: middle; border: 1px solid #ddd; padding: 6px; text-align: left; font-size: 8pt;">
                        {% if college.history %}
                        {% for record in college.history %}
                        <div style="margin-bottom: 2px;">
                            <strong>{{ record.year }}:</strong>
                            <span style="display: inline-block; margin-right: 5px;">分数:{{ record.admission_score
                                }}</span>
                            <span style="display: inline-block; margin-right: 5px;">线差:{{ record.province_score_diff
                                }}</span>
                            <div style="margin-top: 1px;">
                                <span style="display: inline-block; margin-right: 5px;">位次:{{ record.rank }}</span>
                                <span style="display: inline-block;">计划:{{ record.plan_number }}</span>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div style="text-align: center;">暂无历史数据</div>
                        {% endif %}
                    </td>
                    <td style="text-align: center; vertical-align: middle; border: 1px solid #ddd; padding: 6px;">
                        <strong>同意</strong>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>

</html>